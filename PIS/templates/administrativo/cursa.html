{% extends "index.html" %}
{% block content %}
<script>
    $(document).ready(function(){
        $("#link").click(function(){
            create();
        });

        $("#busqueda").change(function(){
            elegir_busqueda();
        });

        $("#busca").click(function(){
            buscar();
        });
    });

    function tabla(url){
        $.ajax({
            method: "GET",
            url: url,
            contentType: 'json',
            success: function(data){
                if(data.code == '200'){
                    var html = '';
                    $.each(data.data, function(i, info){
                        html+="<tr>";
                        html+= "<td>"+(i+1)+"</td>";
                        html+= "<td>"+info.paralelo+"</td>";
                        html+= "<td>"+info.idEstudiante+"</td>";
                        html+= "<td>"+info.asignacion+"</td>";
                        html+= "<td>"+info.periodoAcademico+"</td>";
                        html+= "<td>"+'<a href="/docentes/editar/'+info.id+'" class="btn btn-primary btn-sm">Modificar</a>'+"</td>";
                        html+= "<td>"+'<a href="/docentes/eliminar/'+info.id+'" class="btn btn-danger btn-sm">Eliminar</a>'+"</td>";
                        html+="</tr>";
                    });
                    $("#tabla tbody").html(html);
                } else {
                    html += "<tr><td colspan='7'>No se encontraron datos</td></tr>";
                    $("#tabla tbody").html(html);
                }
            }
        });
    }

    function create(){
        var aux = $("#tipo").prop("checked");
        var select = $("#criterio").find(":selected").val();
        if(aux){
            tabla("http://localhost:5000/home/cursa/2/"+select+"/"+ 4);  //cambiar siempre
            //$("#link").attr("href", "/servidores/2/_nombre");
        }else{
            tabla("http://localhost:5000/home/cursa/1/"+select+"/"+ 4); //cambiar siempre
            //$("#link").attr("href", "/servidores/1/_nombre");
        }
    }

    function buscar(){
        
        var atributo = $("#criterio").find(":selected").val();
        //var metodo = "2"
        var valor = $("#valor").val();
        //if(metodo == 1){
        
        tabla("http://localhost:5000/home/cursa/busqueda/"+valor+"/"+atributo); //cambiar
        //}else{
            //tabla("http://localhost:5000/lista/busqueda/2/"+valor+"/"+atributo); //cambiar
        //}
    }

    function elegir_busqueda(){
        var metodo = $("#busqueda").find(":selected").val();
        if(metodo == 1){
            $("#criterio").html('<option value="_nombre">Nombre</option><option value="_apellido">Apellido</option>');
        } else {
            $("#criterio").html('<option value="_cedula">Cedula</option>');
        }
    }
</script>
{% block barra %}
<nav id="scrollspy" class="navbar page-navbar navbar-expand-md navbar-brand fixed-top" data-spy="affix" data-offset-top="20">
    <div class="container">
        <a class="navbar-brand" href="#"><strong class="text-primary">Seguimiento</strong> <span class="text-dark">Estudiantil</span></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/home/{{idPersona}}">Inico</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/home/materias/{{idPersona}}">Materias</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/home/estudiantes">Estudiante</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/home/personas/agrgar">Registro</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/">Salir</a>
                </li>
                <li class="nav-item ml-md-4">
                    <a class="nav-link btn btn-primary" href="components.html">Components</a>
                </li>
            </ul>
        </div>
    </div>
</nav>  
{%endblock%}
<br>
<br>
<div class="container my-4">
    <div class="text-center mb-4">
        <h1 class="display-5 text-dark">Cursa</h1>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="criterio">Criterio:</label>
                    <select id="criterio" class="custom-select" style="margin-left: 15%">
                        <option value="_paralelo">Paralelo</option>
                    </select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <div class="custom-control custom-checkbox" style="margin-left: 15%">
                        <input type="checkbox" class="custom-control-input" id="tipo">
                        <label class="custom-control-label" for="tipo">DESCENDENTE</label>
                    </div>
                    <button class="btn btn-info ml-3" id="link">ORDENAR</button>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="valor">Texto:</label>
                    <input type="text" id="valor" class="form-control" placeholder="Ingrese el valor a buscar" style="margin-left: 15%">
                </div>
                <div class="col-md-4 align-self-end">
                    <button class="btn btn-info ml-3" id="busca">BUSCAR</button>    
                </div>
            </div>
        </div>
    </div>
<br>
<br>
<div class="row">
    <div class="col-12">
        <table id="tabla" class="table table-striped table-bordered text-center bg-white">
            <thead class="thead-dark">
                <tr>
                    <th>Nro</th>
                    <th>Paralelo</th>
                    <th>Id-Estudiante</th>
                    <th>Asignaci√≥n</th>
                    <th>Periodo-Academico</th>
                    <th>Acciones</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody>
                {% for item in lista %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.paralelo }}</td>
                        <td>{{ item.idEstudiante }}</td>
                        <td>{{ item.asignacion }}</td>
                        <td>{{ item.periodoAcademico }}</td>
                        <td><a href="/docentes/editar/{{ item.id }}" class="btn btn-primary btn-sm">Modificar</a></td>
                        <td><a href="/docentes/eliminar/{{ item.id }}" class="btn btn-danger btn-sm">Eliminar</a></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
